<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Upload Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        padding: 20px;
        max-width: 600px;
        margin: auto;
      }
      label {
        display: block;
        margin-top: 12px;
      }
      button {
        margin-top: 20px;
        padding: 10px 20px;
        background: #00ffff;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h2>üß† MindAR Admin Panel</h2>

    <label>Target Name</label>
    <input id="name" placeholder="e.g. anime" style="width:100%;padding:6px;" />

    <label>.mind file</label>
    <input id="mindFile" type="file" accept=".mind" />

    <label>Video file (.mp4)</label>
    <input id="videoFile" type="file" accept="video/mp4" />

    <button id="upload">Upload</button>
    <p id="status"></p>

    <script>
      const SUPABASE_URL = "https://vleqrpqfjkcazeowczjy.supabase.co";
      const SUPABASE_KEY = "sb_publishable_yB6MBOTVLquZgR4X6yqhTQ_0wBFkhrZ";
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      const uploadBtn = document.getElementById("upload");
      const status = document.getElementById("status");

      uploadBtn.addEventListener("click", async () => {
        const name = document.getElementById("name").value.trim();
        const mindFile = document.getElementById("mindFile").files[0];
        const videoFile = document.getElementById("videoFile").files[0];

        if (!name || !mindFile || !videoFile) {
          alert("Please provide all inputs!");
          return;
        }

        status.textContent = "‚è≥ Uploading files...";

        const timestamp = Date.now();
        const mindPath = `minds/${timestamp}-${mindFile.name}`;
        const videoPath = `videos/${timestamp}-${videoFile.name}`;

        const { error: mindErr } = await supabase.storage
          .from("assets")
          .upload(mindPath, mindFile, { upsert: true });
        if (mindErr) return (status.textContent = "‚ùå Mind upload failed: " + mindErr.message);

        const { error: videoErr } = await supabase.storage
          .from("assets")
          .upload(videoPath, videoFile, { upsert: true });
        if (videoErr) return (status.textContent = "‚ùå Video upload failed: " + videoErr.message);

        const mindUrl = supabase.storage.from("assets").getPublicUrl(mindPath).data.publicUrl;
        const videoUrl = supabase.storage.from("assets").getPublicUrl(videoPath).data.publicUrl;

        const { error: dbErr } = await supabase.from("targets").insert([{ name, mindUrl, videoUrl }]);
        if (dbErr) return (status.textContent = "‚ùå Database insert failed: " + dbErr.message);

        status.textContent = "‚úÖ Upload complete!";
      });
    </script>
  </body>
</html>
