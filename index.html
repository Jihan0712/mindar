<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://unpkg.com/aframe-chromakey-material/dist/aframe-chromakey-material.min.js"></script>

  <script>
    AFRAME.registerComponent('mytarget', {
      init: function () {
        const videoEl = document.querySelector('#video'); // Audio-only video
        const danPlane = document.querySelector('#dan-plane'); // Chromakey plane

        this.el.addEventListener('targetFound', event => {
          console.log("üéØ Target FOUND!");
          videoEl.play(); // Play audio
          danPlane.setAttribute('visible', true); // Show chromakey video
        });

        this.el.addEventListener('targetLost', event => {
          console.log("‚ùå Target LOST");
          videoEl.pause(); // Pause audio
          danPlane.setAttribute('visible', false); // Hide chromakey video
        });
      }
    });
  </script>
</head>
<body>
  <a-scene 
    mindar-image="imageTargetSrc: ./targets.mind; showStats: false;" 
    embedded 
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights" 
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false"
  >
    <a-assets>
      <!-- AUDIO-ONLY VIDEO -->
      <video id="video" loop autoplay muted src="./overlay.mp4"></video>

      <!-- CHROMAKEY VIDEO (same file, but rendered with green screen removal) -->
      <video id="chromaVideo" loop autoplay muted src="./overlay.mp4"></video>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity id="mytarget" mytarget mindar-image-target="targetIndex: 0">
      <!-- TEXT (optional) -->
      <a-text value="" id="text-en" color="purple" align="center" width="2" position="0 0.4 0"
        animation="property: position; to: 0 0.5 0; dur: 1000; easing: easeInOutQuad; loop: true; dir: alternate"
      ></a-text>

      <!-- CHROMAKEY PLANE -->
      <a-plane 
        id="dan-plane"
        material="
          shader: chromakey;
          src: #chromaVideo;
          color: 0.1 0.9 0.2;
          transparent: true;"
        width="1"
        height="0.552"
        position="0 0 0"
        rotation="0 0 0"
        visible="false"
      ></a-plane>
    </a-entity>
  </a-scene>
</body>
</html>